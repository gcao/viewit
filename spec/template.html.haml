!!!
%html{:lang => "en", "xml:lang" => "en", :xmlns => "http://www.w3.org/1999/xhtml"}
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "content-type"}/
    %meta{:content => "chrome=1", "http-equiv" => "X-UA-Compatible"}/
    %title= title
    %link{:href => "test_files/bundle_common.css", :media => "screen", :rel => "stylesheet", :type => "text/css"}/
    %link{:href => "test_files/bundle_gist.css", :media => "screen", :rel => "stylesheet", :type => "text/css"}/
    %script{:charset => "utf-8", :type => "text/javascript"}
      var GitHub = {}
    %script{:src => "test_files/jquery-1.js", :type => "text/javascript"}
    %script{:src => "test_files/bundle_common.js", :type => "text/javascript"}
    %script{:src => "test_files/bundle_gist.js", :type => "text/javascript"}
    -# TODO
    %link{:href => "http://github.com/api/oembed?format=json&amp;url=http%3A%2F%2Fgist.github.com%2F566725", :rel => "alternate", :title => "gist: 566725", :type => "application/json+oembed"}/
    :javascript
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3769691-4']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    %script{:async => "true", :src => "test_files/ga.js"}
  %body.usingMouse
    #main
      #header
        .site
          .logo
            %a{:href => gist_homepage_url}
              %img{:alt => "gist", :src => "test_files/logo_gist.png"}/
          .userbox
            .avatarname
              %a{:href => logged_in_user.view_url}
                %img{:alt => "", :height => "20", :src => logged_in_user.logo_url, :width => "20"}/
              %a.name{:href => logged_in_user.view_url}= logged_in_user.username
            %ul.usernav
              %li
                %a{:href => logged_in_user.dashboard_url}= messages.dashboard_link_label
              %li
                %a{:href => logged_in_user.inbox_url}= messages.inbox_link_label
                %a.unread_count{:href => logged_in_user.inbox_url}= logged_in_user.message_count
              %li
                %a{:href => logged_in_user.view_url}= messages.settings_link_label
              %li
                %a{:href => logout_url}= messages.logout_link_label
          / /.userbox
          .topsearch
            %form#top_search_form{:action => gist_search_form.action, :method => gist_search_form._method}
              %input.search.notnative.placeholder{:name => "q", :placeholder => messages.gist_search_input_floating_text, :results => "5", :type => "search"}/
              %input.button{:type => "submit", :value => "Search"}/
              %input{:name => "page", :type => "hidden", :value => "1"}/
            %ul.nav
              %li
                %a{:href => gist_homepage_url}= messages.new_gist_link_label
              %li
                %a{:href => my_gists_url}= messages.my_gists_link_label
              %li
                %a{:href => starred_gists_url}= messages.starred_gists_link_label
              %li
                %a{:href => all_gists_url}= messages.all_gists_link_label
              %li
                %a{:href => homepage_url}= messages.back_to_github_link_label
          / /.topsearch
      .site
        .secondary
          #owner
            .actor
              .gravatar
                %img{:alt => "", :height => "30", :src => current_gist.owner.logo_url, :width => "30"}/
              .name
                %a{:href => current_gist.owner.view_url}= current_gist.owner.username
                %span= messages.gist_owner_label
          #forks.fork-info
            %h3= messages.forks_label
            %ul.gists.forks
              - current_gist.forks do |fork|
                %li= render_with_hash(messages.gist_item,     |
                  :_id => current_gist._id,                   |
                  :user => current_gist.owner.username,       |
                  :user_url => current_gist.owner.view_url,   |
                  :created_at => fork.created_at,             |
                  :created_at_alias => fork.created_at_alias) |
          #revisions
            %h3= messages.revisions_label
            %ul
              - current_gist.revisions.each_with_index do |rev, i|
                %li{:class => (i == 0 ? "current" : "other")}
                  - rev.changes_abbr.input.each_char do |char|
                    - color = char == "+" ? "green" : (char == "-" ? "red" : "gray")
                    %img{:alt => "", :src => "test_files/dot_#{color}.png"}/
                  %a.id{:href => rev.view_url}= rev._id
                  %a.author{:href => rev.owner.view_url}= rev.owner.username
                  %span.date
                    %abbr.relatize.relatized{:title => rev.created_at}= rev.created_at_alias
        / /.secondary
        .main
          #repos
            .repo.public
              .title
                .path
                  #{messages.gist_label} #{current_gist._id}
                  %a{:href => current_gist.download_url}
                    %img.button{:alt => "Download_button", :border => "0", :src => "test_files/download_button.png"}/
                  %a{:href => current_gist.fork_url}
                    %img.button{:alt => "fork", :src => "test_files/fork_button.png"}/
                  %a{:href => current_gist.star_url}
                    %img.button{:alt => "star", :src => "test_files/star_button.png"}/
                - if current_gist.is_public
                  .security.public_security{:style => ""}
                    %a{:href => "#public_repo", :rel => "facebox"}
                      %img{:alt => "public", :src => "test_files/public.png"}/
                #private_repo.hidden
                  = messages.private_gist_desc
                #public_repo.hidden
                  = messages.public_gist_desc
              .meta
                %table
                  %tbody
                    %tr
                      %td.label Description:
                      %td
                        .description
                          %span#gist-text-description.edit How to use Rails 3.0's new notification system to inject custom log events
                    %tr
                      %td.label Public Clone URL:
                      %td
                        %a.git_url_facebox{:href => "git://gist.github.com/566725.git", :rel => "#git-clone"} git://gist.github.com/566725.git
                        #git-clone{:style => "display: none; min-width: 500px;"}
                          Give this clone URL to anyone.
                          %br/
                          %code git clone git://gist.github.com/566725.git gist-566725
                    %tr
                      %td.label Embed All Files:
                      %td
                        %a.gist-embed-link{:href => "#"} show embed
                        %input.gist-embed-box{:size => "25", :style => "display: none;", :type => "text", :value => "&lt;script src=&quot;http://gist.github.com/566725.js&quot;&gt; &lt;/script&gt;"}/