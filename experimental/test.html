<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>


  
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
      <title>gist: 566725 - How to use Rails 3.0's new notification system to inject custom log events- GitHub</title>
    

    <link href="test_files/bundle_common.css" media="screen" rel="stylesheet" type="text/css">
<link href="test_files/bundle_gist.css" media="screen" rel="stylesheet" type="text/css">

    <script type="text/javascript" charset="utf-8">
      var GitHub = {}
    </script>
    <script src="test_files/jquery-1.js" type="text/javascript"></script>
    <script src="test_files/bundle_common.js" type="text/javascript"></script>
<script src="test_files/bundle_gist.js" type="text/javascript"></script>

            
    
  <link href="http://github.com/api/oembed?format=json&amp;url=http%3A%2F%2Fgist.github.com%2F566725" rel="alternate" title="gist: 566725" type="application/json+oembed">

        <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3769691-4']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    </script><script async="true" src="test_files/ga.js"></script>

  </head><body class="usingMouse">
    <div id="main">
      <div id="header" class="">
        <div class="site">
          <div class="logo">
            <a href="http://gist.github.com/"><img src="test_files/logo_gist.png" alt="gist"></a>
          </div>

          
            






  
    <div class="userbox">
      <div class="avatarname">
        <a href="http://github.com/gcao"><img src="test_files/6f67bf7db5209823d24a3720746047f6.jpg" alt="" height="20" width="20"></a>
        <a href="http://github.com/gcao" class="name">gcao</a>

        
        
      </div>
      <ul class="usernav">
        <li><a href="https://github.com/">Dashboard</a></li>
        <li>
          
          <a href="https://github.com/inbox">Inbox</a>
          <a href="https://github.com/inbox" class="unread_count ">0</a>
        </li>
        <li><a href="https://github.com/account">Account Settings</a></li>
                        <li><a href="http://gist.github.com/logout">Log Out</a></li>
      </ul>
    </div><!-- /.userbox -->
  


          

          <div class="topsearch">
            <form action="/gists/search" id="top_search_form" method="get">
              <input name="q" results="5" class="search notnative placeholder" placeholder="Search Gists…" type="search"> <input value="Search" class="button" type="submit">
              <input name="page" value="1" type="hidden">
            </form>

            <ul class="nav">
              <li><a href="http://gist.github.com/">New Gist</a></li>
              
                <li><a href="http://gist.github.com/mine">My Gists</a>
                </li><li><a href="http://gist.github.com/starred">Starred Gists</a>
              
              </li><li><a href="http://gist.github.com/gists">All Gists</a></li>
              <li><a href="http://github.com/">Back to GitHub</a></li>
            </ul>
          </div><!-- /.topsearch -->
        </div>
      </div>

    <div class="site">
      
<div class="secondary">

  <div id="owner">
    
      <div class="actor">
        <div class="gravatar">
          <img src="test_files/93bd250c06436d254229792b44b2d677.jpg" alt="" height="30" width="30">
        </div>
        <div class="name"><a href="http://gist.github.com/mnutt">mnutt</a> <span>(owner)</span></div>
      </div>
    
  </div>

  

  
  
    <div class="fork-info" id="forks">
      <h3>Forks</h3>
      <ul class="gists forks">
      
        <li>
          <a href="http://gist.github.com/613672">gist: 613672</a>
          by <a href="http://gist.github.com/rbazinet">rbazinet</a>
          <span class="description"></span>
          <small>created <span class="date"><abbr class="relatize relatized" title="2010-10-06 09:55:49">October 06, 2010</abbr></span></small>
        </li>
      
        <li>
          <a href="http://gist.github.com/613683">gist: 613683</a>
          by <a href="http://gist.github.com/aitor">aitor</a>
          <span class="description"></span>
          <small>created <span class="date"><abbr class="relatize relatized" title="2010-10-06 09:59:09">October 06, 2010</abbr></span></small>
        </li>
      
        <li>
          <a href="http://gist.github.com/618063">gist: 618063</a>
          by <a href="http://gist.github.com/JonGretar">JonGretar</a>
          <span class="description"></span>
          <small>created <span class="date"><abbr class="relatize relatized" title="2010-10-09 02:40:39">4 days ago</abbr></span></small>
        </li>
      
        <li>
          <a href="http://gist.github.com/618310">gist: 618310</a>
          by <a href="http://gist.github.com/stonegao">stonegao</a>
          <span class="description"></span>
          <small>created <span class="date"><abbr class="relatize relatized" title="2010-10-09 08:47:10">4 days ago</abbr></span></small>
        </li>
      
      </ul>
    </div>
  

  
  
  <div id="revisions">
    <h3>Revisions</h3>
    <ul>
      
      
        
        <li class="current">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/636766f1a8510723ddaa5eef1c78cecd2054075a" class="id">636766</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-10-06 10:13:54">October 06, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/964f16e11f79c8e7cacfc02e185f87be15dc7f5a" class="id">964f16</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-09 13:56:36">September 09, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/b19b3fde342d86866c943ce24dfa70d1a2ad23e8" class="id">b19b3f</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-09 13:53:34">September 09, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/c5c4f7ee440dc5fc4798e6f366e2b172d004447e" class="id">c5c4f7</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-09 13:41:36">September 09, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/17801623d78e38419366aa4814f4890e56105b5f" class="id">178016</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-09 13:41:01">September 09, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/1b121fb75e41ca9e64f1068bf8a3ea7d3555c2dc" class="id">1b121f</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-09 13:20:13">September 09, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/e5a5f640623f5b7916ff4c445af3d72fe379778f" class="id">e5a5f6</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-09 13:19:06">September 09, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/7e1557c97d02bb026c274ed865b2b3b110f788cd" class="id">7e1557</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-06 12:18:58">September 06, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/25978243fbcda7a44ee29a09b5e5b265c28f945b" class="id">259782</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-06 12:16:28">September 06, 2010</abbr></span>
        </li>
      
        
        <li class="other">
          <img src="test_files/dot_green.png" alt=""><img src="test_files/dot_red.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt=""><img src="test_files/dot_gray.png" alt="">
          <a href="http://gist.github.com/566725/fc1524333a44f8f691b7bfc050fe009a80659bd3" class="id">fc1524</a>

          
            <a href="http://gist.github.com/mnutt" class="author">mnutt</a>
          
          <span class="date"><abbr class="relatize relatized" title="2010-09-06 12:06:17">September 06, 2010</abbr></span>
        </li>
      
    </ul>
  </div>
  
</div><!-- /.secondary -->

<div class="main">
  <div id="repos">
    <div class="repo public">
      <div class="title">
        <div class="path">
          gist: 566725

          

          
            <a href="http://gist.github.com/gists/566725/download"><img alt="Download_button" class="button" src="test_files/download_button.png" border="0"></a>
          

          
            
            <a href="http://gist.github.com/fork/566725"><img alt="fork" class="button" src="test_files/fork_button.png"></a>
          
          
            
              <a href="http://gist.github.com/star/566725"><img alt="star" class="button" src="test_files/star_button.png"></a>
            
          
        </div>

        
          <div class="security public_security" style="">
            <a href="#public_repo" rel="facebox"><img src="test_files/public.png" alt="public"></a>
          </div>
        

        <div id="private_repo" class="hidden">
          <h2>Private Gist</h2>
          <p>
            All pages are served over SSL and all pushing and pulling is done over SSH.
            No one may fork, clone, or view it unless they are given this private URL.
          </p>
          <p>Every gist with this icon (<img src="test_files/private.png" alt="private">) is private.</p>
        </div>
        <div class="security public_security" style="display: none;">
          <a href="#public_repo" rel="facebox"><img src="test_files/public.png" alt="public"></a>
        </div>
        <div id="public_repo" class="hidden">
          <h2>Public Gist</h2>
          <p>Anyone may fork, clone, or view it.</p>
          <p>Every repository with this icon (<img src="test_files/public.png" alt="public">) is public.</p>
        </div>
      </div>

      <div class="meta">
        <table>
          
          <tbody><tr>
            <td class="label">Description:</td>
            <td>
              <div class="description">
                <span id="gist-text-description" class="edit">How to use Rails 3.0's new notification system to inject custom log events</span>
                
              </div>
            </td>
          </tr>
          

          
            <tr>
              <td class="label">Public Clone URL:</td>
              <td>
                <a rel="#git-clone" class="git_url_facebox" href="git://gist.github.com/566725.git">git://gist.github.com/566725.git</a>
                <div id="git-clone" style="display: none; min-width: 500px;">
                  Give this clone URL to anyone.
                  <br>

                  <code>git clone git://gist.github.com/566725.git gist-566725</code>
                </div>
              </td>
            </tr>
          

          

          
            <tr>
              <td class="label">Embed All Files:</td>
              <td>
                <a href="#" class="gist-embed-link">show embed</a>
                <input class="gist-embed-box" size="25" value="&lt;script src=&quot;http://gist.github.com/566725.js&quot;&gt; &lt;/script&gt;" style="display: none;" type="text">
              </td>
            </tr>
          

        </tbody></table>
      </div>
    </div>
  </div>

  <div id="files">

    
    
      

      <div class="file" id="file_instrument anything in rails 3.md">
  <div class="meta clearfix">
    <div class="info">
      <span class="code">Instrument Anything in Rails 3.md <a href="#file_instrument%20anything%20in%20rails%203.md">#</a></span>
    </div>
    <div class="actions">
      
      <div id="gist-embed" style="display: inline;">
        <a href="#" class="gist-embed-link">embed</a>
        <input class="gist-embed-box" size="25" value="&lt;script src=&quot;http://gist.github.com/566725.js?file=Instrument%20Anything%20in%20Rails%203.md&quot;&gt;&lt;/script&gt;" style="display: none;" type="text">
      </div>
      
      
      <a href="http://gist.github.com/raw/566725/7d55736227e112d2811ccbc58af66e5acbf95e06/Instrument%20Anything%20in%20Rails%203.md">raw</a>
    </div>
  </div>
  
  
  <div id="readme" class="blob">
    <div class="wikistyle"><h1>Instrument Anything in Rails 3</h1>

<p>With Rails 3.0 released a few weeks ago I've migrated a few apps and 
I'm constantly finding useful new improvements.  One such improvement is
 the ability to log anything in the same way that Rails internally logs 
ActiveRecord and ActionView.  By default Rails 3 logs look slightly 
spiffier than those produced by Rails 2.3: (notice the second line has 
been cleaned up)</p>

<pre><code>Started GET "/" for 127.0.0.1 at Mon Sep 06 01:07:11 -0400 2010
  Processing by HomeController#index as HTML
  User Load (0.2ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 3) LIMIT 1
  CACHE (0.0ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 3) LIMIT 1
Rendered layouts/_nav.html.erb (363.4ms)
Rendered layouts/_nav.html.erb (1.1ms)
Rendered layouts/_footer.html.erb (2.6ms)
Rendered home/index.html.erb within layouts/application (503.6ms)
Completed 200 OK in 510ms (Views: 507.9ms | ActiveRecord: 406.3ms)
</code></pre>

<p>This output format is very informative, but what if we're using 
MongoDB or CouchDB instead of ActiveRecord? What if our page has a Solr 
query that takes up a signification portion of the response time, and we
 want to break it out of the total?</p>

<p>The app I'm working on at Market.io uses Solr extensively via the <a href="http://delsolr.rubyforge.org/">delsolr</a>
 gem.  Since delsolr is not Rails-specific, I have created a wrapper 
around the service calls to add hooks.  If I wanted to log Solr queries I
 could just add <code>Rails.logger.info "Solr query: #{query}"</code> but now Rails provides a better way.</p>

<p>In Rails 3, logging has been abstracted into <a href="http://rdoc.info/github/rails/rails/v3.0.0/ActiveSupport/Notifications">ActiveSupport::Notifications</a>, which publishes logging events, and <a href="http://rdoc.info/github/rails/rails/v3.0.0/ActiveSupport/LogSubscriber">ActiveSupport::LogSubscriber</a>,
 which consumes the events and logs the output.  This abstraction lets 
any number of entities publish notifications. (I'm calling those 
entities "services" for the purpose of this article, but any call can be
 instrumented.)</p>

<p>ActiveRecord provides an excellent example of how to subscribe to 
notifications.  I've adapted it to delsolr with minimal changes.  First 
we tell Rails what to instrument:</p>

<pre><code>class SolrDocument
  def self.query(query_type, options={})
    ActiveSupport::Notifications.instrument("query.delsolr",
                                            :query =&gt; options) do
      ProductDocument.delsolr_client.query(query_type, options)
    end
  end
end
</code></pre>

<p>I've wrapped my client call in an ActiveSupport::Notifications block with the first argument in the format <code>{action}.{service}</code>.
  The second argument is the "payload", a hash that gets passed to the 
log subscriber.  In order to catch the notification, we need to write a 
subscriber:</p>

<pre><code>module SolrInstrumentation
  class LogSubscriber &lt; ActiveSupport::LogSubscriber
    def query(event)
      return unless logger.debug?

      name = '%s (%.1fms)' % ["SOLR Query", event.duration]

      # produces: 'query: "foo" OR "bar", rows: 3, ...'
      query = event.payload[:query].map{ |k, v| "#{k}: #{color(v, BOLD, true)}" }.join(', ')

      debug "  #{color(name, YELLOW, true)}  [ #{query} ]"
    end
  end
end
</code></pre>

<p>The subscriber will receive an event with a method <code>#payload</code> that returns the hash we passed in earlier with the <code>:duration</code> key added.  We simply construct a log line and then use <code>#debug</code> to output it to our logfile.  ActiveSupport::LogSubscriber comes with a <code>#color</code> method that makes highlighting output very easy.</p>

<p>Next, we need to register our subscriber to receive events.  We attach our LogSubscriber to all events in the <code>delsolr</code> namespace:</p>

<pre><code>SolrInstrumentation::LogSubscriber.attach_to :delsolr
</code></pre>

<p>The next step would be to instrument our other Solr calls such as <code>delete</code> and <code>commit</code> by wrapping the Solr calls with "delete.delsolr" and "commit.delsolr" and adding the appropriate methods.</p>

<p>Now we should have something like this in our Rails log:</p>

<pre><code>Started GET "/" for 127.0.0.1 at Mon Sep 06 01:07:11 -0400 2010
  Processing by HomeController#index as HTML
  User Load (0.2ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 3) LIMIT 1
  CACHE (0.0ms)  SELECT `users`.* FROM `users` WHERE (`users`.`id` = 3) LIMIT 1
  SOLR Query (52.2ms)  [ rows: 25, query: "rails 3" OR "rails 2.3", start: 0, fields: * score, sort: created_at desc ]
Rendered layouts/_nav.html.erb (363.4ms)
Rendered layouts/_nav.html.erb (1.1ms)
Rendered layouts/_footer.html.erb (2.6ms)
Rendered home/index.html.erb within layouts/application (503.6ms)
Completed 200 OK in 562ms (Views: 507.9ms | ActiveRecord: 406.3ms)
</code></pre>

<p>Now it's easy to spot and debug the Solr queries, but it would be 
nice to see the breakout as well.  For that we need to extend our 
controllers.</p>

<pre><code>module SolrInstrumentation
  module ControllerRuntime
    extend ActiveSupport::Concern

    protected

    def append_info_to_payload(payload)
      super
      payload[:solr_runtime] = SolrInstrumentation::LogSubscriber.runtime
    end

    module ClassMethods
      def log_process_action(payload)
        messages, solr_runtime = super, payload[:solr_runtime]
        messages &lt;&lt; ("Solr: %.1fms" % solr_runtime.to_f) if solr_runtime
        messages
      end
    end
  end
end

ActiveSupport.on_load(:action_controller) do
  include SolrInstrumentation::ControllerRuntime
end
</code></pre>

<p>Notice that we no longer have to jump through the <code>self.included</code>
 hoops anymore; in Rails 3 we can extend ActiveSupport::Concern to 
easily add features to ActionController.  ActionController has 
instrumented the entire request in the same way that we instrumented our
 Solr call, so we just need to call our controller's <code>#append_info_to_payload</code> hook to inject our runtime info into the request notification event.  Lastly, we use the <code>#log_process_action</code> hook to catch the payload we just modified and generate a message, which should appear in the logs:</p>

<pre><code>Completed 200 OK in 562ms (Views: 507.9ms | ActiveRecord: 406.3ms | Solr: 52.2ms)
</code></pre>

<p>Solr normally shouldn't be called in the views, but if your service 
is used frequently in views and you don't want it to count towards the 
view's rendering time you can add a <code>#cleanup_view_runtime</code> 
method to the ControllerRuntime module to return the real view rendering
 time.  It involves a bit more work in calculating the service's 
runtime; check out the <a href="http://github.com/rails/rails/blob/master/activerecord/lib/active_record/log_subscriber.rb">source of ActiveRecord::LogSubscriber</a> for an example.</p>

<p>Rails 3's notifications open up a lot of possibilities for both 
publishing and subscribing to events. Already Ilya Grigorik has taken 
advantage of this in his <a href="http://www.igvita.com/2010/07/19/speed-tracer-server-side-tracing-with-rack/">Speed Tracer Rack middleware</a> by subscribing to timing events and outputting them to Google Chrome's <a href="http://code.google.com/webtoolkit/speedtracer/">Speed Tracer</a> browser extension.  I imagine notifications will simplify NewRelic's monitoring gem as well.</p>

<p>Thanks to Bryan Helmkamp (<a href="http://twitter.com/brynary">@brynary</a>) for technical proofreading.</p></div>
  </div>


  
</div>


      

     <!-- cache end -->

    

  </div>

  
    <div id="comments">
      
        <h2>2 Comments</h2>
        <div class="new-comments">
          
            
<div class="comment gist-comment   " id="gistcomment-11340">
  <div class="cmeta">
    <p class="author">
      <span class="gravatar"><img src="test_files/b27766abb4ad9958522a340db11b5ffa.jpg" alt="" height="20" width="20"></span>
      <strong class="author"><a href="http://gist.github.com/unimatrixZxero">unimatrixZxero</a></strong>
      <em>
        <a href="#gistcomment-11340">
        commented
        </a>
      </em>
      
    </p>
    <p class="info">
      <em class="date"><abbr class="relatize relatized" title="2010-10-08 04:32:25">5 days ago</abbr></em>
      <span class="icon"></span>
    </p>
  </div>
  <div class="body">
    
    <div class="formatted-content">
      
      
      <div class="content-body wikistyle">
        <p>Thanx for sharing.</p>
      </div>
    </div>
    
  </div>
</div>

          
            
<div class="comment gist-comment   " id="gistcomment-11700">
  <div class="cmeta">
    <p class="author">
      <span class="gravatar"><img src="test_files/0e48c6edbc780e069f225a295f9ca65d.png" alt="" height="20" width="20"></span>
      <strong class="author"><a href="http://gist.github.com/jistr">jistr</a></strong>
      <em>
        <a href="#gistcomment-11700">
        commented
        </a>
      </em>
      
    </p>
    <p class="info">
      <em class="date"><abbr class="relatize relatized" title="2010-10-13 01:31:15">about 18 hours ago</abbr></em>
      <span class="icon"></span>
    </p>
  </div>
  <div class="body">
    
    <div class="formatted-content">
      
      
      <div class="content-body wikistyle">
        <p>Thanks :)</p>
      </div>
    </div>
    
  </div>
</div>

<div class="comment gist-comment gist-owner-tag adminable" id="gistcomment-14033">
  <div class="cmeta">
    <p class="author">
      <span class="gravatar"><img src="https://secure.gravatar.com/avatar/6f67bf7db5209823d24a3720746047f6?s=140&amp;d=https%3A%2F%2Fgithub.com%2Fimages%2Fgravatars%2Fgravatar-140.png" alt="" width="20" height="20" /></span> <strong class="author"><a href="/gcao">gcao</a></strong> <em><a href="#gistcomment-14033">commented</a></em> <span class="tag">gist owner</span>
    </p>
    <p class="info">
      <em class="date"><abbr class="relatize" title="2010-11-15 06:36:21">Mon Nov 15 06:36:21 -0800 2010</abbr></em>
    </p>
  </div>
  <div class="body">
    <p class="error" style="display:none">
      There was a problem with your request, please try again
    </p>
    <div class="formatted-content">
      <ul class="actions">
        <li>
          <a href="#" class="minibutton btn-edit edit-button"><span>Edit</span></a>
        </li>
        <li>
          <a href="#" class="minibutton btn-delete delete-button"><span>Delete</span></a>
        </li>
      </ul>
      <div class="content-body wikistyle">
        <p>
          Test again
        </p>
      </div>
    </div>
    <div class="context-loader" style="display:none">
      Sending Request…
    </div>
    <div class="form-content" style="display:none">
      <form action="/459949/comment/14033" id="edit_gist_comment_14033" method="post">
        <div style="margin:0;padding:0">
          <input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="95d0a0ea0527b6defc3db51b5262cda9d76ef0e5" />
        </div>
        <textarea cols="40" id="gist_comment_body" name="gist_comment[body]" rows="20" tabindex="100">
Test again
</textarea>
        <div class="form-actions">
          <a href="#" class="minibutton danger cancel"><span>Cancel</span></a> <button type="submit" class="minibutton" tabindex="100"><span>Update Comment</span></button>
        </div>
      </form>
    </div>
  </div>
</div>
          
        </div>
      

      
        <form action="/566725/comment" method="post"><div style="margin: 0pt; padding: 0pt;"><input name="authenticity_token" value="a5bcb6359cb829762edbd920e08531c66d7c89cf" type="hidden"></div>
          
<p class="comment-form-error" style="display: none;">You must write something to leave a comment</p>
<div class="comment-form previewable-comment-form">
  <p class="help">Comments are parsed with <a href="http://github.github.com/github-flavored-markdown/" target="_blank">GitHub Flavored Markdown</a></p>
  <ul class="tabs inline-tabs">
    <li><a class="selected" href="#write_bucket_554" action="write">Write</a></li>
    <li><a href="#preview_bucket_554" action="preview">Preview</a></li>
  </ul>
  <div style="display: block;" id="write_bucket_554" class="tab-content">
    <textarea name="comment[body]" tabindex="1" id="comment_body_554"></textarea>
  </div>
  <div style="display: none;" id="preview_bucket_554" class="new-comments tab-content">
    
<div class="comment normal-comment   " id="openstruct-69981417896720">
  <div class="cmeta">
    <p class="author">
      <span class="gravatar"><img src="test_files/6f67bf7db5209823d24a3720746047f6_002.jpg" alt="" height="20" width="20"></span>
      <strong class="author"><a href="http://gist.github.com/gcao">gcao</a></strong>
      <em>
        <a href="#openstruct-69981417896720">
        commented
        </a>
      </em>
      
    </p>
    <p class="info">
      <em class="date"><abbr class="relatize relatized" title="2010-10-13 19:38:34">just now</abbr></em>
      <span class="icon"></span>
    </p>
  </div>
  <div class="body">
    
    <div class="formatted-content">
      
      
      <div class="content-body wikistyle"><p>Nothing to preview</p></div>
    </div>
    
  </div>
</div>

  </div>
</div>

          <div class="form-actions">
            <button type="submit" class="classy"><span>Add Gist Comment</span></button>
          </div>
        </form>
      
    </div>
  

</div><!-- /.main -->

    </div> <!-- site -->

    <div class="push"></div>

    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="logo">
            <a href="http://github.com/">
              <img src="test_files/logo_white.png" alt="GitHub">
            </a>
          </div>
          <div class="more">
            <div class="links">
              <a href="http://github.com/blog"><strong>Blog</strong></a> |
              <a href="http://support.github.com/?sso=_-D9qfwBNALVWtVhGCwVCzX3G3akBoO36XQ8M-kMER3mItaw2V5DpBTBMMTZiae4Dy18bMl-4CJK9MAEfFy_AVxwQJCk9XLtmSniAFz-VwjxAgL_Y1a_AZCRN_NnN6BhwhzBiVv89zTITQLYmRgcKqL4266Twjvpq5OnO8TG7gQyEaDwrnI5NdirdlFH1PuBGunRV50LqokexyIfWDGT-Le8TR22PIsWgDPi9S-Hwhg">Support</a> |
              <a href="http://github.com/contact">Contact</a> |
              <a href="http://github.com/site/privacy">Privacy</a> |
              <a href="http://github.com/site/terms">Terms of Service</a>
            </div>
            <div class="company">
              ©
              2010
              GitHub Inc.
              All rights reserved.
           </div>
          </div>
        </div>
        <div class="sponsor">
          <div>
            Powered by the <a href="http://www.rackspace.com/">Dedicated
            Servers</a> and<br> <a href="http://www.rackspacecloud.com/">Cloud
            Computing</a> of Rackspace Hosting<span>®</span>
          </div>
          <a href="http://www.rackspace.com/">
            <img alt="Dedicated Server" src="test_files/rackspace_logo.png">
          </a>
        </div>
      </div>
    </div>

    <script>window._auth_token = "a5bcb6359cb829762edbd920e08531c66d7c89cf"</script>
      <div id="facebox" style="display: none;">       <div class="popup">         <div class="content">         </div>         <a href="#" class="close"><img src="test_files/closelabel.png" title="close" class="close_image"></a>       </div>     </div></body></html>